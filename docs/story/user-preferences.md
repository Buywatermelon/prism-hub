# 用户偏好设置 - 用户故事

## 产品愿景
在一个工作空间组内共享 AI 资源，管理员配置一次，全组成员即可根据个人偏好流畅使用。

## 核心原则
- **极致简洁**：只有一个设置 - 供应商优先顺序
- **资源共享**：管理员提供资源池，成员自由使用
- **个性化**：每个成员有自己的偏好顺序
- **智能处理**：系统自动处理所有技术细节

---

## 管理员故事

### 故事 1.1: 资源配置
**作为**工作空间管理员  
**我想要**添加团队的 AI 服务凭证  
**以便**为团队提供 AI 资源池  

**验收标准**：
- 支持三大供应商：Claude、OpenAI、Gemini
- 为每个凭证设置友好名称（如"团队账号"、"备用账号"）
- 添加后自动测试可用性
- 显示简单的状态：✅ 可用 / ⚠️ 需要关注 / ❌ 不可用

**管理员只管理资源池，不设置使用优先级**

---

### 故事 1.2: 默认顺序设置（可选）
**作为**工作空间管理员  
**我想要**设置一个推荐的供应商顺序  
**以便**新成员有个合理的起点  

**验收标准**：
- 可以设置工作空间的默认顺序
- 新成员加入时自动应用此顺序
- 成员可以随时调整为个人顺序
- 仅作为初始值，不强制

**示例**：
```
工作空间默认顺序：
1. Claude
2. OpenAI  
3. Gemini
```

---

### 故事 1.3: 资源监控
**作为**工作空间管理员  
**我想要**了解资源使用情况  
**以便**及时补充资源  

**验收标准**：
- 查看各供应商的可用凭证数
- 收到资源不足的提醒
- 无需管理复杂的优先级规则
- 专注于"资源是否充足"

---

## 普通成员故事

### 故事 2.1: 个人偏好设置
**作为**团队成员  
**我想要**设置我偏好的供应商顺序  
**以便**优先使用我熟悉的 AI 服务  

**验收标准**：
- 简单拖拽调整供应商优先级
- 设置独立保存，不影响其他成员
- 立即生效，无需额外确认
- 可以重置为工作空间默认顺序

**示例界面**：
```
我的供应商偏好（拖动排序）：
1. ⬍ OpenAI   
2. ⬍ Claude     
3. ⬍ Gemini   

[重置为默认]
```

**简洁原则**：
- 不需要选择具体模型
- 不需要理解技术差异
- 只是简单的顺序偏好

---

### 故事 2.2: 无感使用
**作为**团队成员  
**我想要**专注于我的工作  
**以便**不被技术问题打断  

**验收标准**：
- 请求自动路由到可用服务
- 服务不可用时自动切换备选
- 最多 2-3 秒的切换延迟
- 保持对话上下文

**用户体验**：
- 正常情况：直接返回结果
- 切换时：显示"正在连接..."（1-2秒）
- 全部不可用："服务暂时繁忙，请稍后再试"

---

### 故事 2.3: 简单反馈
**作为**团队成员  
**我想要**在遇到问题时得到简单指引  
**以便**知道该做什么  

**验收标准**：
- 错误信息人性化：
  - ❌ "Error 429: Rate limit exceeded"
  - ✅ "服务繁忙，正在为您切换..."
- 提供简单的操作建议：
  - "如持续出现此问题，请联系管理员"
- 一键报告问题给管理员

---

## 系统故事

### 故事 3.1: 智能调度
**作为**系统  
**我需要**智能管理凭证使用  
**以便**最大化资源可用性  

**实现逻辑**：
- 轮询同优先级凭证，避免单点过载
- 记录失败模式，预测性避让
- OAuth 凭证定时检查恢复（如 Claude 5小时）
- API Key 凭证指数退避重试

**对用户透明**：
- 所有复杂逻辑在后台运行
- 用户只看到"可用"或"不可用"

---

### 故事 3.2: 自动恢复
**作为**系统  
**我需要**自动恢复暂时不可用的服务  
**以便**保持最大可用性  

**实现逻辑**：
- OAuth 类：按已知周期（5小时）检查
- API Key 类：渐进式重试（1分钟 → 5分钟 → 15分钟）
- 恢复后自动加入可用池

**对用户透明**：
- 用户无需手动刷新
- 恢复后自动可用

---

## 实施优先级

### Phase 1 - MVP（第一周）
- ✅ 管理员添加凭证（资源池）
- ✅ 成员设置个人偏好顺序
- ✅ 基础故障转移
- ✅ 从工作空间默认继承

### Phase 2 - 增强（第二周）
- ✅ 凭证状态监控
- ✅ 智能轮询
- ✅ 自动恢复机制
- ✅ 偏好模板管理

### Phase 3 - 优化（后续）
- ✅ 个人使用统计
- ✅ 智能推荐偏好
- ✅ 团队使用分析

---

## 成功指标

1. **配置效率**：
   - 管理员 3 分钟内添加所有凭证
   - 成员 30 秒内设置好个人偏好

2. **使用流畅度**：
   - 95% 的请求使用首选供应商
   - 故障切换延迟 < 3 秒

3. **用户自主性**：
   - 每个成员都有自己的偏好设置
   - 偏好调整即时生效

4. **资源利用率**：
   - 所有可用凭证都被有效利用
   - 自动负载均衡避免单点过载

---

## 设计原则

### Do's ✅
- 使用友好的语言和图标
- 提供合理的默认值
- 自动处理复杂逻辑
- 快速响应用户操作

### Don'ts ❌
- 暴露技术错误码（429、503）
- 要求用户理解 RPM、TPM
- 显示复杂的配置选项
- 让用户手动处理故障